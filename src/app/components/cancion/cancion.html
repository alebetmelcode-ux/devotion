<app-toolbar></app-toolbar>

<div class="song-editor">

  <h1>Editar canción</h1>

  <form [formGroup]="songForm" (ngSubmit)="saveSong()" class="form-grid">

    <!-- TÍTULO -->
    <div class="form-group">
      <label>Título *</label>
      <input
        pInputText
        type="text"
        formControlName="tituloCancion"
        placeholder="Título de la canción">
    </div>

    <!-- CONTROLES -->
    <div class="form-group controls-cell">
      <label>Subir/bajar Nota *</label>

      <div class="controls-row">

        <!-- TONO -->
        <div class="key-selector-inline">
          <button
            pButton
            type="button"
            class="p-button-text"
            (click)="transposeDown()">
            <i class="fa-solid fa-chevron-down"></i>
          </button>

          <span class="current-key">
            {{ songForm.get('tonoOriginal')?.value }}
          </span>

          <button
            pButton
            type="button"
            class="p-button-text"
            (click)="transposeUp()">
            <i class="fa-solid fa-chevron-up"></i>
          </button>
        </div>

        <!-- MODO -->
        <div class="mode-toggle-inline">
          <button
            pButton
            type="button"
            label="Editar"
            size="small"
            [class.p-button-outlined]="mode !== 'edit'"
            (click)="mode = 'edit'">
          </button>

          <button
            pButton
            type="button"
            label="Ver"
            size="small"
            [class.p-button-outlined]="mode !== 'view'"
            (click)="mode = 'view'">
          </button>
        </div>

        <!-- EXPORTAR -->
        <div class="export-buttons-inline">
          <button
            pButton
            type="button"
            class="p-button-text"
            (click)="exportAs('pdf')"
            pTooltip="Exportar a PDF"
            tooltipPosition="bottom">
            <i class="fa-solid fa-file-pdf"></i>
          </button>

          <button
            pButton
            type="button"
            class="p-button-text"
            (click)="exportAs('jpg')"
            pTooltip="Exportar a JPG"
            tooltipPosition="bottom">
            <i class="fa-solid fa-image"></i>
          </button>

          <button
            pButton
            type="button"
            class="p-button-text"
            (click)="exportAs('ppt')"
            pTooltip="Exportar a PowerPoint"
            tooltipPosition="bottom">
            <i class="fa-solid fa-file-powerpoint"></i>
          </button>
        </div>

      </div>
    </div>

    <!-- CATEGORÍA -->
    <div class="form-group">
      <label>Categoría *</label>
      <p-select
        [options]="categorias"
        optionLabel="descripcionCategoria"
        optionValue="id"
        formControlName="idCategoria">
      </p-select>
    </div>

    <!-- BUSCAR -->
    <div class="form-group">
      <label>Buscar canción existente</label>
      <p-autoComplete
        [suggestions]="filteredSongs"
        (completeMethod)="filterSongs($event)"
        (onSelect)="onSongSelected($event)"
        optionLabel="tituloCancion"
        placeholder="Buscar por título o letra"
        [dropdown]="true">
      </p-autoComplete>
    </div>

    <!-- EDICIÓN -->
    <div class="form-group span-2" *ngIf="mode === 'edit'">
      <label>Letra con acordes *</label>
      <textarea
        pInputTextarea
        rows="15"
        formControlName="letra"
        spellcheck="false"
        class="chords-textarea">
      </textarea>
    </div>

    <!-- VISTA -->
    <div class="form-group span-2" *ngIf="mode === 'view'">
      <label>Vista previa</label>
      <div class="song-view" [innerHTML]="highlightedLyrics"></div>
    </div>

    <!-- ACCIONES -->
    <div class="form-actions span-2">
      <button
        pButton
        type="button"
        label="Cancelar"
        class="p-button-secondary"
        (click)="onCancel()">
      </button>

      <button
        pButton
        type="submit"
        label="Guardar Canción"
        [disabled]="songForm.invalid">
      </button>

      <button
        *ngIf="songForm.get('id')?.value"
        pButton
        type="button"
        label="Eliminar Canción"
        class="p-button-danger"
        (click)="deleteSong()">
      </button>
    </div>

  </form>
</div>
