<app-toolbar></app-toolbar>

<div class="song-editor">

  <h2>
    {{ songToEdit() ? 'Editar Canción' : 'Nueva Canción' }}
  </h2>

  <form
    [formGroup]="songForm"
    (ngSubmit)="saveSong()"
    class="form-grid">

    <!-- ================= TÍTULO ================= -->
    <div class="form-group span-2">
      <label for="tituloCancion">Título *</label>
      <input
        id="tituloCancion"
        type="text"
        formControlName="tituloCancion"
        placeholder="Nombre de la canción">
    </div>

    <!-- ================= TONO ================= -->
    <div class="form-group">
      <label>Tono Original *</label>

      <div class="key-selector-inline">
        <button
          type="button"
          class="transpose-btn"
          (click)="transposeDown()">
          <lucide-icon name="chevron-down"></lucide-icon>
        </button>

        <span class="current-key">
          {{ songForm.get('tonoOriginal')?.value }}
        </span>

        <button
          type="button"
          class="transpose-btn"
          (click)="transposeUp()">
          <lucide-icon name="chevron-up"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- ================= CATEGORÍA ================= -->
    <div class="form-group">
      <label for="idCategoria">Categoría *</label>
      <select
        id="idCategoria"
        formControlName="idCategoria"
        [disabled]="categoriasCargando">
        <option value="">
          {{ categoriasCargando ? 'Cargando...' : 'Seleccionar categoría' }}
        </option>
        <option
          *ngFor="let cat of categorias"
          [value]="cat.id">
          {{ cat.descripcionCategoria }}
        </option>
      </select>
    </div>

    <!-- ================= BUSCAR / SELECCIONAR CANCIÓN ================= -->
    <div class="form-group span-2">
      <label for="songAutocomplete">Buscar canción</label>

      <p-autoComplete
  formControlName="tituloCancion"
  [suggestions]="filteredSongs"
  (completeMethod)="filterSongs($event)"
  (onSelect)="onSongSelected($event)"
  optionLabel="tituloCancion"
  placeholder="Buscar por título o letra"
  [forceSelection]="true"
  [dropdown]="true"
  class="w-full">
</p-autoComplete>
    </div>

    <!-- ================= LETRA ================= -->
    <div class="form-group span-2">
      <label for="letra">Letra con acordes *</label>

      <div class="lyrics-editor-wrapper">
        
        <div
          class="lyrics-backdrop"
          [innerHTML]="highlightedLyrics">
        </div>

        <textarea
          id="letra"
          formControlName="letra"
          rows="15"
          (scroll)="syncScroll($event)"
          spellcheck="false"
          autocomplete="off">
        </textarea>
        
      </div>

      <small>
        Escribe una línea con los acordes y debajo la letra correspondiente
      </small>
    </div>

    <!-- ================= ACCIONES ================= -->
    <div class="form-actions span-2">
      <button
        type="button"
        class="btn-secondary"
        (click)="onCancel()">
        Cancelar
      </button>

      <button
        type="submit"
        class="btn-primary"
        [disabled]="songForm.invalid">
        {{ songToEdit() ? 'Actualizar' : 'Guardar' }} Canción
      </button>
    </div>

  </form>

  <!-- ================= EXPORTAR ================= -->
  <div class="export-actions">
    <h3>Exportar</h3>

    <button
      class="btn-secondary"
      (click)="exportPDF()">
      PDF
    </button>
    

    <button
      class="btn-secondary"
      (click)="exportPPT()">
      PPT
    </button>

    <button
      class="btn-secondary"
      (click)="exportJPG()">
      JPG
    </button>
  </div>

</div>
